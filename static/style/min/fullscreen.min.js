!function(){function e(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>e.apply(this,i),t)}}function t(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}let n=!1,i=!1;function a(){const a=document.querySelector(".game-container");if(!a)return void console.error("Fullscreen: Game container not found.");const o=document.createElement("button");o.id="fullscreen-btn",o.type="button",o.title="Enter Fullscreen",o.className="fullscreen-button",o.innerHTML='\n            <svg width="24" height="24" viewBox="0 0 70 70" xmlns="http://www.w3.org/2000/svg">\n              <rect x="5" y="5" width="60" height="60" fill="none" stroke="#fff" stroke-width="6" rx="3"/>\n              <g fill="none" stroke="#fff" stroke-width="4" stroke-linecap="square">\n                <path d="M15 25 L15 15 L25 15"/>\n                <path d="M55 25 L55 15 L45 15"/>\n                <path d="M15 45 L15 55 L25 55"/>\n                <path d="M55 45 L55 55 L45 55"/>\n              </g>\n            </svg>\n        ';const r=document.createElement("button");r.id="exit-fullscreen-btn",r.type="button",r.title="Exit Fullscreen",r.className="exit-fullscreen-button",r.innerHTML='\n            <svg width="24" height="24" viewBox="0 0 70 70" xmlns="http://www.w3.org/2000/svg">\n              <rect x="5" y="5" width="60" height="60" fill="none" stroke="#fff" stroke-width="6" rx="3"/>\n              <g fill="none" stroke="#fff" stroke-width="4" stroke-linecap="square">\n                <path d="M25 15 L25 25 L15 25"/>\n                <path d="M45 15 L45 25 L55 25"/>\n                <path d="M25 55 L25 45 L15 45"/>\n                <path d="M45 55 L45 45 L55 45"/>\n              </g>\n            </svg>\n        ';const s=document.createElement("div");s.id="ios_fullscreen_layer",s.style.display="none",s.className="fixed inset-0 z-[9999] bg-black flex items-center justify-center",s.setAttribute("aria-label","iOS伪全屏"),s.setAttribute("role","dialog");const l=document.createElement("div");l.id="ios_landscape_tip",l.className="absolute top-4 left-4 bg-black/50 px-3 py-1 rounded pointer-events-none select-none z-10 flex items-center justify-center",l.style.cssText="max-width: 70vw; display: none; height:40px; width:40px;",l.innerHTML='\n            <svg width="32" height="32" viewBox="0 0 48 48" fill="none" aria-label="请横屏" focusable="false">\n                <rect x="8" y="16" width="32" height="16" rx="3" fill="#fff" fill-opacity="0.8"/>\n                <rect x="8" y="16" width="32" height="16" rx="3" stroke="#2563eb" stroke-width="2"/>\n                <path d="M16 12v4M32 12v4" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>\n                <path d="M16 36v-4M32 36v-4" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>\n                <path d="M4 24h4M40 24h4" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>\n            </svg>\n        ',s.appendChild(l),document.body.appendChild(s);const d=document.createElement("button");d.id="ios_fullscreen_exit_btn",d.onclick=()=>y(),d.className="fixed top-4 right-4 bg-white text-black rounded-full w-12 h-12 shadow-lg z-[10001] items-center justify-center",d.setAttribute("aria-label","退出全屏"),d.style.cssText="font-size: 2rem; line-height: 1; display: none;",d.innerHTML="×",document.body.appendChild(d),a.appendChild(o),a.appendChild(r);const c={wrapper:document.getElementById("game_section"),container:a,iframe:document.getElementById("game_iframe"),fullscreenBtn:o,exitFullscreenBtn:r,gameIntro:document.getElementById("game_intro"),iosLayer:s,iosExitBtn:d,iosLandscapeTip:l};for(const e in c)if(!c[e])return void console.error(`Fullscreen: Element '${e}' not found.`);let p=!1,m=!1,u=null,h=null;function f(){const e=c.iframe,t=c.iosLayer,a=c.iosExitBtn;c.gameIntro;n||g(),e.classList.add("ios-fullscreen"),t.appendChild(e),t.style.display="flex",a.style.display="flex",document.body.style.overflow="hidden",i=!0,screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").catch(e=>{console.log("屏幕方向锁定失败:",e)});const o=c.iosLandscapeTip;o.style.display="flex",setTimeout(()=>{o.style.display="none"},3e3),c.wrapper.classList.add("fullscreen")}function y(){const e=c.iframe,t=c.iosLayer,a=c.iosExitBtn;e.classList.remove("ios-fullscreen"),c.container.appendChild(e),t.style.display="none",a.style.display="none",document.body.style.overflow="",i=!1,screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),c.wrapper.classList.remove("fullscreen"),n||(c.gameIntro.classList.remove("hidden"),c.iframe.classList.add("hidden"))}function g(){const e=c.iframe,t=c.gameIntro;n||(n=!0,e.classList.remove("hidden"),t.classList.add("hidden"),window.dispatchEvent(new Event("gameStarted")),setTimeout(()=>{!function(){try{const e=document.getElementById("game_iframe");if(e&&e.contentWindow.postMessage({type:"ENABLE_AUDIO",action:"ios_user_interaction"},"*"),window.webkitAudioContext){const e=new webkitAudioContext,t=e.createBuffer(1,1,22050),n=e.createBufferSource();n.buffer=t,n.connect(e.destination),n.start(0),"suspended"===e.state&&e.resume()}console.log("iOS audio activation attempted")}catch(e){console.log("iOS audio activation error:",e)}}()},500))}function w(e){const t=document.querySelector('meta[name="viewport"]');t?e?(null===u&&(u=t.content),t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"):null!==u&&(t.content=u):console.warn("Fullscreen: Viewport meta tag not found.")}function b(){null===h&&(h={wrapper:{position:c.wrapper.style.position,width:c.wrapper.style.width,height:c.wrapper.style.height,maxWidth:c.wrapper.style.maxWidth,maxHeight:c.wrapper.style.maxHeight,zIndex:c.wrapper.style.zIndex,top:c.wrapper.style.top,left:c.wrapper.style.left,padding:c.wrapper.style.padding,paddingTop:c.wrapper.style.paddingTop,margin:c.wrapper.style.margin,backgroundColor:c.wrapper.style.backgroundColor,borderRadius:c.wrapper.style.borderRadius,minHeight:c.wrapper.style.minHeight,display:c.wrapper.style.display,flexDirection:c.wrapper.style.flexDirection,justifyContent:c.wrapper.style.justifyContent,alignItems:c.wrapper.style.alignItems,animation:c.wrapper.style.animation,backgroundSize:c.wrapper.style.backgroundSize},container:{position:c.container.style.position,width:c.container.style.width,height:c.container.style.height,maxWidth:c.container.style.maxWidth,maxHeight:c.container.style.maxHeight,top:c.container.style.top,left:c.container.style.left,margin:c.container.style.margin,padding:c.container.style.padding,borderRadius:c.container.style.borderRadius,aspectRatio:c.container.style.aspectRatio,minHeight:c.container.style.minHeight,background:c.container.style.background},iframe:{position:c.iframe.style.position,width:c.iframe.style.width,height:c.iframe.style.height,maxWidth:c.iframe.style.maxWidth,maxHeight:c.iframe.style.maxHeight,top:c.iframe.style.top,left:c.iframe.style.left,border:c.iframe.style.border,borderRadius:c.iframe.style.borderRadius,margin:c.iframe.style.margin,padding:c.iframe.style.padding,zIndex:c.iframe.style.zIndex,display:c.iframe.style.display},body:{overflow:document.body.style.overflow,position:document.body.style.position,width:document.body.style.width,height:document.body.style.height}}),w(!0),c.gameIntro.classList.add("hidden"),c.iframe.classList.remove("hidden"),Object.assign(c.wrapper.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",maxWidth:"none",maxHeight:"none",paddingTop:"0",padding:"0",margin:"0",zIndex:"2147483647",backgroundColor:"#000",borderRadius:"0",minHeight:"unset",display:"block",flexDirection:"unset",justifyContent:"unset",alignItems:"unset",animation:"none",backgroundSize:"unset"}),Object.assign(c.container.style,{position:"absolute",top:"0",left:"0",width:"100vw",height:"100vh",maxWidth:"none",maxHeight:"none",margin:"0",padding:"0",borderRadius:"0",aspectRatio:"unset",minHeight:"unset",background:"black"}),Object.assign(c.iframe.style,{position:"absolute",top:"0",left:"0",width:"100vw",height:"100vh",maxWidth:"none",maxHeight:"none",border:"none",borderRadius:"0",margin:"0",padding:"0",zIndex:"10000",display:"block"}),Object.assign(document.body.style,{overflow:"hidden",position:"fixed",width:"100%",height:"100%"}),c.wrapper.classList.add("fullscreen"),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").catch(e=>{console.warn("Screen orientation lock failed:",e.message)})}function x(){t()?i?y():f():p?k():v()}const v=e(function(e){if(e&&(e.preventDefault(),e.stopPropagation()),!m&&!p){m=!0;try{b(),p=!0}catch(e){console.error("Fullscreen enter error:",e)}finally{setTimeout(()=>{m=!1},50)}}},250),k=e(function(e){if(e&&(e.preventDefault(),e.stopPropagation()),!m&&p){m=!0;try{!function(){if(!h)return;w(!1),!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)||n||(c.gameIntro.classList.remove("hidden"),c.iframe.classList.add("hidden")),Object.assign(c.wrapper.style,h.wrapper),c.wrapper.style.maxWidth=h.wrapper.maxWidth||"",c.wrapper.style.maxHeight=h.wrapper.maxHeight||"",c.wrapper.style.padding=h.wrapper.padding||"",c.wrapper.style.margin=h.wrapper.margin||"",c.wrapper.style.borderRadius=h.wrapper.borderRadius||"",c.wrapper.style.minHeight=h.wrapper.minHeight||"",c.wrapper.style.display=h.wrapper.display||"",c.wrapper.style.flexDirection=h.wrapper.flexDirection||"",c.wrapper.style.justifyContent=h.wrapper.justifyContent||"",c.wrapper.style.alignItems=h.wrapper.alignItems||"",c.wrapper.style.animation=h.wrapper.animation||"",c.wrapper.style.backgroundSize=h.wrapper.backgroundSize||"",Object.assign(c.container.style,h.container),c.container.style.maxWidth=h.container.maxWidth||"",c.container.style.maxHeight=h.container.maxHeight||"",c.container.style.margin=h.container.margin||"",c.container.style.padding=h.container.padding||"",c.container.style.borderRadius=h.container.borderRadius||"",c.container.style.aspectRatio=h.container.aspectRatio||"",c.container.style.minHeight=h.container.minHeight||"",c.container.style.background=h.container.background||"",c.iframe.style.maxWidth=h.iframe?.maxWidth||"",c.iframe.style.maxHeight=h.iframe?.maxHeight||"",c.iframe.style.border=h.iframe?.border||"",c.iframe.style.borderRadius=h.iframe?.borderRadius||"",c.iframe.style.margin=h.iframe?.margin||"",c.iframe.style.padding=h.iframe?.padding||"",c.iframe.style.zIndex=h.iframe?.zIndex||"",c.iframe.style.display=h.iframe?.display||"",Object.assign(document.body.style,h.body),c.wrapper.classList.remove("fullscreen"),screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock()}(),p=!1}catch(e){console.error("Fullscreen exit error:",e)}finally{setTimeout(()=>{m=!1},50)}}},250);c.fullscreenBtn.addEventListener("click",x),c.fullscreenBtn.addEventListener("touchend",x,{passive:!1}),c.exitFullscreenBtn.addEventListener("click",x),c.exitFullscreenBtn.addEventListener("touchend",x,{passive:!1}),window.addEventListener("orientationchange",e(()=>{i?setTimeout(()=>{i&&f()},150):p&&setTimeout(b,150)},250)),window.addEventListener("popstate",()=>{i?y():p&&k()}),document.addEventListener("visibilitychange",()=>{document.hidden&&(i?y():p&&k())}),document.addEventListener("fullscreenchange",()=>{!p||document.fullscreenElement||t()||b()}),o.style.display="none",r.style.display="none",window.addEventListener("gameStarted",function(){o.style.display="flex",r.style.display="none",n=!0}),window.playGame=function(){const e=document.getElementById("game_intro"),i=document.getElementById("game_iframe");if(e&&i)if(t())g();else{e.classList.add("hidden"),i.classList.remove("hidden"),o.style.display="flex",n=!0,window.dispatchEvent(new Event("gameStarted"));try{i.contentWindow.postMessage({type:"ENABLE_AUDIO",action:"user_interaction"},"*"),setTimeout(()=>{try{const e=i.contentDocument||i.contentWindow.document;if(e){const t=e.createElement("audio");t.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE",t.volume=.1,t.play().catch(()=>{})}}catch(e){console.log("Audio activation attempted via postMessage")}},500)}catch(e){console.log("Audio activation failed:",e)}}},window.enterIOSFullscreen=f,window.exitIOSFullscreen=y,window.isIOS=t}const o=document.createElement("style");o.textContent="\n        /* iOS全屏遮罩层样式 */\n        #ios_fullscreen_layer {\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background-color: black !important;\n            z-index: 9999 !important;\n        }\n\n        /* iOS 全屏模式下的iframe基础样式 */\n        #game_iframe.ios-fullscreen {\n            position: absolute !important;\n            z-index: 10001 !important;\n            border: none !important;\n            margin: 0 !important;\n            padding: 0 !important;\n            background-color: black !important;\n        }\n\n        /* 横屏设备样式 */\n        @media (orientation: landscape) {\n            #game_iframe.ios-fullscreen {\n                top: 0 !important;\n                left: 0 !important;\n                width: 100vw !important;\n                height: 100vh !important;\n                transform: none !important;\n            }\n        }\n\n        /* 竖屏设备样式 */\n        @media (orientation: portrait) {\n            #game_iframe.ios-fullscreen {\n                /* 在屏幕中心旋转90度 */\n                top: 50% !important;\n                left: 50% !important;\n                width: 100vh !important; /* 使用视口高度作为宽度 */\n                height: 100vw !important; /* 使用视口宽度作为高度 */\n                transform: translate(-50%, -50%) rotate(90deg) !important;\n                transform-origin: center center !important;\n            }\n\n            /* 竖屏模式下确保关闭按钮在正确位置 */\n            #ios_fullscreen_exit_btn {\n                top: 20px !important;\n                right: 20px !important;\n                z-index: 10002 !important;\n            }\n        }\n    ",document.head.appendChild(o),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()}();