const emojiData={common:{name:"COM",emojis:["ğŸ˜Š","ğŸ˜‚","â¤ï¸","ğŸ‘","ğŸ‰","âœ¨","ğŸŒŸ","ğŸ’¯","ğŸ”¥","ğŸ‘","ğŸ™","ğŸ’ª","ğŸ¤”","ğŸ¤£","ğŸ˜…","ğŸ˜†"]},faces:{name:"FACE",emojis:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜…","ğŸ˜†","ğŸ˜‰","ğŸ˜Š","ğŸ˜‹","ğŸ˜","ğŸ˜","ğŸ˜˜","ğŸ¥°","ğŸ˜—","ğŸ˜™","ğŸ˜š","ğŸ™‚","ğŸ¤—","ğŸ¤©","ğŸ˜","ğŸ˜’","ğŸ˜","ğŸ˜”","ğŸ˜Ÿ","ğŸ˜•","ğŸ™","ğŸ˜£","ğŸ˜–","ğŸ˜«","ğŸ˜¢","ğŸ˜­","ğŸ˜¤","ğŸ˜ "]},gestures:{name:"GEST",emojis:["ğŸ‘","ğŸ‘","ğŸ‘Œ","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ‘Š","âœŠ","ğŸ‘","ğŸ™Œ","ğŸ‘","ğŸ¤²","ğŸ™","ğŸ’ª","ğŸ‘‹","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ‘‡","âœ‹","ğŸ–","ğŸ––"]},nature:{name:"NATU",emojis:["ğŸŒ¸","ğŸ’®","ğŸŒ¹","ğŸŒº","ğŸŒ»","ğŸŒ¼","ğŸŒ·","ğŸŒ±","ğŸŒ²","ğŸŒ³","ğŸŒ´","ğŸŒµ","ğŸŒ¾","ğŸŒ¿","ğŸ€","ğŸ","ğŸ‚","ğŸƒ","ğŸ‡","ğŸˆ","ğŸ‰","ğŸŠ","ğŸ‹","ğŸŒ"]},symbols:{name:"SYM",emojis:["â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ’”","â£ï¸","ğŸ’•","ğŸ’","ğŸ’“","ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’Ÿ","â˜®ï¸","âœï¸","â˜ªï¸","ğŸ”¯","âœ¡ï¸","ğŸ•","â˜¸ï¸"]}};let currentEmojiTargetId=null;function generateEmojiPanel(e,t,n={}){const o="string"==typeof e?document.getElementById(e):e;if(!o)return;const i=o.id||`emoji-panel-${Math.random().toString(36).substring(2,9)}`;let l;if(o.id||(o.id=i),l="string"==typeof t?document.getElementById(t):t,!l)return void console.error("ç›®æ ‡è¾“å…¥æ¡†æœªæ‰¾åˆ°");o.classList.contains("emoji-panel")||o.classList.add("emoji-panel","custom-emoji-panel");let s='<div class="emoji-tabs">';Object.keys(emojiData).forEach((e,t)=>{s+=`<button type="button" class="emoji-tab ${0===t?"active":""}" data-category="${e}">${emojiData[e].name}</button>`}),s+="</div>";let a="";return Object.keys(emojiData).forEach((e,t)=>{a+=`<div id="${i}-${e}" class="emoji-grid" ${0===t?"":'style="display:none;"'}>`,emojiData[e].emojis.forEach(e=>{a+=`<span class="emoji-item" data-emoji="${e}">${e}</span>`}),a+="</div>"}),o.innerHTML=s+a,o.dataset.initialized="true",o.querySelectorAll(".emoji-item").forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("data-emoji")||this.textContent;insertEmojiToElement(l,t),o.style.display="none"})}),o.querySelectorAll(".emoji-tab").forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("data-category");switchEmojiCategoryInPanel(o,t)})}),o}function insertEmojiToElement(e,t){if(!e)return;const n=e.selectionStart,o=e.selectionEnd,i=e.value;e.value=i.substring(0,n)+t+i.substring(o),e.focus(),e.selectionStart=e.selectionEnd=n+t.length}function switchEmojiCategoryInPanel(e,t){if(!e)return;const n=e.id;e.querySelectorAll(".emoji-grid").forEach(e=>{e.style.display="none"});const o=document.getElementById(`${n}-${t}`);o&&(o.style.display="grid"),e.querySelectorAll(".emoji-tab").forEach(e=>{e.classList.remove("active")}),e.querySelectorAll(`.emoji-tab[data-category="${t}"]`).forEach(e=>{e.classList.add("active")})}function initMainCommentEmojis(){const e=document.getElementById("desktop-emoji-panel"),t=document.getElementById("comment-input-desktop");if(e&&t){generateEmojiPanel(e,t);const n=document.getElementById("desktop-emoji-btn");n&&(n.onclick=function(n){n.preventDefault(),toggleEmojiPanelElement(e,t)})}const n=document.getElementById("mobile-emoji-panel"),o=document.getElementById("comment-input-mobile");if(n&&o){generateEmojiPanel(n,o);const e=document.getElementById("mobile-emoji-btn");e&&(e.onclick=function(e){e.preventDefault(),toggleEmojiPanelElement(n,o)})}}function initExistingReplyFormEmojis(){document.querySelectorAll(".reply-form").forEach(e=>{e.dataset.emojiInitialized||initReplyFormEmoji(e)})}function setupReplyFormObserver(){new MutationObserver(e=>{e.forEach(e=>{e.addedNodes&&e.addedNodes.length>0&&e.addedNodes.forEach(e=>{1===e.nodeType&&e.classList.contains("reply-form")&&!e.dataset.emojiInitialized&&setTimeout(()=>initReplyFormEmoji(e),50)})})}).observe(document.body,{childList:!0,subtree:!0})}function toggleEmojiPanelElement(e,t){e&&(e.dataset.initialized||generateEmojiPanel(e,t),"none"!==e.style.display&&e.style.display&&""!==e.style.display?e.style.display="none":(e.style.display="block",document.querySelectorAll(".emoji-panel").forEach(t=>{t!==e&&"none"!==t.style.display&&(t.style.display="none")}),setTimeout(()=>{document.addEventListener("click",function t(n){if(!e)return void document.removeEventListener("click",t);const o=e.parentNode;e.contains(n.target)||o&&o.contains(n.target)&&n.target!==e||(e.style.display="none",document.removeEventListener("click",t))})},100)))}function toggleEmojiPanel(e,t){console.log("åˆ‡æ¢è¡¨æƒ…é¢æ¿",e,t);const n=document.getElementById(e),o=document.getElementById(t);n&&o&&(currentEmojiTargetId=t,window.innerWidth<=768&&"mobile-emoji-panel"===e&&(n.dataset.targetInput=t,n.querySelectorAll(".emoji-item").forEach(e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",function(){const e=this.getAttribute("data-emoji")||this.textContent,t=document.getElementById(currentEmojiTargetId);insertEmojiToElement(t||o,e),n.style.display="none"})})),toggleEmojiPanelElement(n,o))}function switchEmojiCategory(e,t){const n=document.getElementById(e);n&&switchEmojiCategoryInPanel(n,t)}function insertEmoji(e,t){let n=null;currentEmojiTargetId&&(n=document.getElementById(currentEmojiTargetId)),n||(n=document.getElementById(e)),n&&insertEmojiToElement(n,t)}function debugEmojiTrigger(){console.log("ğŸ” è¡¨æƒ…æŒ‰é’®è°ƒè¯•äº‹ä»¶æ£€æŸ¥å¼€å§‹...");const e=document.querySelectorAll('.emoji-trigger, [onclick*="toggleEmojiPanel"]');console.log(`æ‰¾åˆ° ${e.length} ä¸ªè¡¨æƒ…æŒ‰é’®`),e.forEach((e,t)=>{console.log(`æŒ‰é’® ${t+1}:`,{type:e.tagName,hasOnclick:!!e.getAttribute("onclick"),onclick:e.getAttribute("onclick"),parentElement:e.parentElement?.className}),e.getAttribute("onclick")||e._hasDebugEvent||e.classList.contains("emoji-trigger")||(console.log(`ä¸ºæŒ‰é’® ${t+1} æ·»åŠ è°ƒè¯•ç‚¹å‡»äº‹ä»¶...`),e._hasDebugEvent=!0,e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log(`è°ƒè¯•: æŒ‰é’® ${t+1} è¢«ç‚¹å‡»!`);const n=this.parentElement,o=n?n.querySelector(".emoji-panel"):null;console.log("æŒ‰é’®å®¹å™¨:",n),console.log("å…³è”é¢æ¿:",o),o&&(console.log("å°è¯•åˆ‡æ¢é¢æ¿æ˜¾ç¤ºçŠ¶æ€"),"none"!==o.style.display&&o.style.display?o.style.display="none":(o.style.display="block",document.querySelectorAll(".emoji-panel").forEach(e=>{e!==o&&"none"!==e.style.display&&(e.style.display="none")}),setTimeout(()=>{document.addEventListener("click",function e(t){o.contains(t.target)||n.contains(t.target)||(o.style.display="none",document.removeEventListener("click",e))})},100)))}))}),console.log("âœ… è¡¨æƒ…æŒ‰é’®è°ƒè¯•äº‹ä»¶ç»‘å®šå®Œæˆ")}window.initReplyFormEmoji=function(e){if(console.log("ğŸ” åˆå§‹åŒ–å›å¤è¡¨å•è¡¨æƒ…é€‰æ‹©å™¨:",e?.id||"æœªçŸ¥è¡¨å•"),!e)return;if("true"===e.dataset.emojiInitialized)return void console.log("âš¡ è¡¨å•å·²åˆå§‹åŒ–ï¼Œè·³è¿‡");const t=e.querySelector(".emoji-picker-container");if(!t)return void console.log("âš ï¸ æ‰¾ä¸åˆ°è¡¨æƒ…é€‰æ‹©å™¨å®¹å™¨");const n=e.querySelector(".reply-content");if(!n)return void console.log("âš ï¸ æ‰¾ä¸åˆ°æ–‡æœ¬è¾“å…¥åŒºåŸŸ");console.log("ğŸ› ï¸ ä¸ºå›å¤è¡¨å•åˆ›å»ºè¡¨æƒ…é€‰æ‹©å™¨å…ƒç´ ");const o=document.createElement("button");o.type="button",o.className="p-2 hover:bg-gray-100 rounded-full",o.title="Insert emoji",o.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <circle cx="12" cy="12" r="10"></circle>\n            <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>\n            <line x1="9" y1="9" x2="9.01" y2="9"></line>\n            <line x1="15" y1="9" x2="15.01" y2="9"></line>\n        </svg>\n    ';const i=document.createElement("div");i.className="emoji-panel custom-emoji-panel",i.style.display="none",t.innerHTML="",t.appendChild(o),t.appendChild(i),console.log("âœ“ æ·»åŠ è¡¨æƒ…æŒ‰é’®å’Œé¢æ¿å®¹å™¨"),n.id=n.id||`reply-textarea-${Math.random().toString(36).substring(2,9)}`,i.id=i.id||`reply-emoji-panel-${Math.random().toString(36).substring(2,9)}`,generateEmojiPanel(i,n),o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log("ç‚¹å‡»å›å¤è¡¨å•è¡¨æƒ…æŒ‰é’®");if(window.innerWidth<=768){document.querySelectorAll(".emoji-panel").forEach(e=>{e.style.display="none"});document.getElementById("mobile-emoji-panel")?toggleEmojiPanel("mobile-emoji-panel",n.id):toggleEmojiPanelElement(i,n)}else toggleEmojiPanelElement(i,n)}),e.dataset.emojiInitialized="true",console.log("âœ… å›å¤è¡¨å•è¡¨æƒ…é€‰æ‹©å™¨åˆå§‹åŒ–å®Œæˆ")},document.addEventListener("DOMContentLoaded",function(){console.log("ğŸš€ emoji-picker.js: DOMåŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–è¡¨æƒ…é€‰æ‹©å™¨ç³»ç»Ÿ..."),initMainCommentEmojis(),initExistingReplyFormEmojis(),setupReplyFormObserver(),console.log("âœ… è¡¨æƒ…é€‰æ‹©å™¨ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ")});