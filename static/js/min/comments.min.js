const OLD_COMMENT_SYSTEM_DISABLED=!1;console.log("âš ï¸ æ—§ç‰ˆè¯„è®ºç³»ç»Ÿä¸´æ—¶å¯ç”¨ï¼Œå»ºè®®è¿ç§»åˆ°æ–°ç‰ˆ comment-system.js");let currentRating=0,allComments=[],displayedComments=[],commentsLoaded=!1,commentsPerPage=10,currentPage=1,totalComments=0,totalPages=0;function isMobile(){return window.innerWidth<=768}function getActiveInputs(){const e=isMobile();return{commentInput:document.getElementById(e?"comment-input-mobile":"comment-input-desktop"),usernameInput:document.getElementById(e?"username-input-mobile":"username-input-desktop"),emailInput:document.getElementById(e?"email-input-mobile":"email-input-desktop"),submitText:document.getElementById(e?"submit-text-mobile":"submit-text-desktop"),submitLoading:document.getElementById(e?"submit-loading-mobile":"submit-loading-desktop")}}function initializeCommentSystem(){console.log("ğŸš€ åˆå§‹åŒ–è¯„è®ºç³»ç»Ÿ..."),setupRatingInput(),loadComments(),document.addEventListener("click",function(e){if(e.target&&(e.target.classList.contains("reply-btn")||e.target.parentElement&&e.target.parentElement.classList.contains("reply-btn"))){const t=e.target.classList.contains("reply-btn")?e.target:e.target.parentElement,o=t.dataset.commentId,n=t.dataset.replyId,s=t.dataset.username,l=parseInt(t.dataset.level||"0");o&&n&&void 0!==s&&(console.log(`ğŸ–±ï¸ é€šè¿‡äº‹ä»¶å§”æ‰˜æ•è·å›å¤æŒ‰é’®ç‚¹å‡»: commentId=${o}, replyId=${n}, username=${s}, level=${l}`),showReplyToReplyForm(o,n,s,l),e.preventDefault(),e.stopPropagation())}if(e.target&&e.target.classList.contains("submit-reply-btn")){const t=e.target.closest(".reply-form");if(t){let o,n;const s=t.id;if(s.startsWith("reply-form-")){n=s.substring(11);const e=/^([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})/,t=n.match(e);o=t?t[1]:n}if(console.log(`ğŸ” Parsed commentId from form ID '${s}': ${o}`),o){if(s.includes("-")&&s.split("-").length>3){const e=n.substring(o.length+1),s=t.querySelector(".reply-to-username"),l=s?s.textContent:"";console.log(`ğŸ–±ï¸ æ•è·æäº¤å›å¤çš„å›å¤æŒ‰é’®ç‚¹å‡»: commentId=${o}, parentReplyId=${e}, parentUsername=${l}`),submitReplyToReply(o,e,l)}else console.log(`ğŸ–±ï¸ æ•è·æäº¤ç›´æ¥å›å¤æŒ‰é’®ç‚¹å‡»: commentId=${o}`),submitReply(o)}else console.error("âŒ Could not parse commentId from form ID:",s);e.preventDefault(),e.stopPropagation()}}e.target&&e.target.classList.contains("cancel-reply-btn")&&(console.log("ğŸ–±ï¸ æ•è·å–æ¶ˆå›å¤æŒ‰é’®ç‚¹å‡»"),hideAllReplyForms(),e.preventDefault(),e.stopPropagation())}),console.log("âœ… è¯„è®ºç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå·²æ·»åŠ å…¨å±€äº‹ä»¶ç›‘å¬")}function setupRatingInput(){console.log("â­ è®¾ç½®è¯„åˆ†è¾“å…¥...");const e=document.querySelectorAll(".rating-input");console.log(`æ‰¾åˆ° ${e.length} ä¸ªè¯„åˆ†æ˜Ÿæ˜Ÿ`),e.forEach((e,t)=>{e.addEventListener("mouseenter",()=>highlightStars(t+1)),e.addEventListener("mouseleave",()=>highlightStars(currentRating)),e.addEventListener("click",()=>setRating(t+1))}),highlightStars(0)}function highlightStars(e){document.querySelectorAll(".rating-input").forEach((t,o)=>{o<e?t.classList.add("active"):t.classList.remove("active")})}function setRating(e){console.log(`â­ ç”¨æˆ·é€‰æ‹©è¯„åˆ†: ${e}`),currentRating=e,highlightStars(e)}async function loadComments(){try{const e=document.getElementById("comments-list"),t=document.getElementById("loading-comments");t&&(t.style.display="block");const o=getArticleUrl();console.log("Loading comments for article_url:",o);const n=`/api/comments${o}?page=1&per_page=50&sort_by=created_at`;console.log("API URL:",n);const s=await fetch(n),l=await s.json();console.log("API response:",l),l.success?(allComments=l.data,totalComments=l.pagination?l.pagination.total:allComments.length,totalPages=l.pagination?l.pagination.pages:1,displayedComments=allComments.slice(0,commentsPerPage),currentPage=1,console.log(`ğŸ“Š è¯„è®ºç»Ÿè®¡: æ€»è®¡${totalComments}æ¡, å½“å‰æ˜¾ç¤º${displayedComments.length}æ¡`),console.log("ğŸ” è°ƒè¯•: æ£€æŸ¥è¯„è®ºæ•°æ®ä¸­çš„å›å¤ç»“æ„"),allComments.forEach((e,t)=>{e.replies&&e.replies.length>0&&(console.log(`ğŸ“ è¯„è®º ${t}: ${e.username} æœ‰ ${e.replies.length} ä¸ªå›å¤`),e.replies.forEach((e,t)=>{console.log(`  å›å¤ ${t}: ${e.username} - children: ${e.children?e.children.length:0}`),e.children&&e.children.length>0&&e.children.forEach((e,t)=>{console.log(`    å­å›å¤ ${t}: ${e.username} - @${e.reply_to_username}`)})}))}),renderComments(),updateCommentStats(),updateLoadMoreButton(),commentsLoaded=!0,loadCommentStats()):(console.error("åŠ è½½è¯„è®ºå¤±è´¥:",l.message),e&&(e.innerHTML='\n                    <div class="text-center py-8">\n                        <p class="text-red-500">Network error, please try again later</p>\n                    </div>\n                '))}catch(e){console.error("åŠ è½½è¯„è®ºå‡ºé”™:",e);const t=document.getElementById("comments-list");t&&(t.innerHTML='\n                <div class="text-center py-8">\n                    <p class="text-red-500">Network error, please try again later</p>\n                </div>\n            ')}finally{const e=document.getElementById("loading-comments");e&&(e.style.display="none")}}function getArticleUrl(){const e=window.location.pathname;return console.log("å½“å‰è·¯å¾„:",e),e}async function loadCommentStats(){try{const e=getArticleUrl(),t=await fetch(`/api/comments${e}/stats`),o=await t.json();if(o.success){updateCommentStatsDisplay(o.data)}}catch(e){console.error("åŠ è½½ç»Ÿè®¡å¤±è´¥:",e)}}function updateCommentStatsDisplay(e){const t=document.getElementById("total-comments"),o=document.getElementById("average-rating");t&&(t.textContent=`${e.total_comments} comments`),o&&(o.textContent=`${e.average_rating} â˜…`)}function renderComments(){const e=document.getElementById("comments-list"),t=document.getElementById("loading-comments");if(0===displayedComments.length)return void(e&&(e.innerHTML='\n                <div class="text-center py-8">\n                    <p class="text-gray-500">No comments yet. Be the first to share your thoughts!</p>\n                </div>\n            '));t&&(t.style.display="none");const o=displayedComments.map(e=>renderComment(e)).join("");e&&(e.innerHTML=o)}function renderComment(e){const t=e.replies&&e.replies.length>0?`<div class="replies">${e.replies.map(t=>renderReply(t,e.comment_id,0)).join("")}</div>`:"";return`\n        <div class="comment-item p-4 mb-4" data-comment-id="${e.comment_id}">\n            <div class="flex items-start space-x-3">\n                <div class="user-avatar">${e.username.charAt(0).toUpperCase()}</div>\n                <div class="flex-1">\n                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-2 comment-header-mobile">\n                        <div class="flex items-center space-x-2">\n                            <span class="font-medium text-gray-900">${escapeHtml(e.username)}</span>\n                            <div class="rating-stars">\n                                ${"â˜…".repeat(e.rating)}${"â˜†".repeat(5-e.rating)}\n                            </div>\n                        </div>\n                        <span class="text-sm text-gray-500">${formatTime(e.created_at)}</span>\n                    </div>\n                    <p class="comment-content text-gray-700 mb-3 text-sm md:text-base">${escapeHtml(e.content)}</p>\n                    <div class="comment-actions flex items-center space-x-4">\n                        <button onclick="likeComment('${e.comment_id}')" class="btn-secondary flex items-center space-x-1">\n                            <span>ğŸ‘</span>\n                            <span>${e.likes}</span>\n                        </button>\n                        <button onclick="showReplyForm('${e.comment_id}', 0)" class="btn-secondary">\n                            Reply\n                        </button>\n                    </div>\n                    ${t}\n                </div>\n            </div>\n        </div>\n    `}function renderReply(e,t,o=0){if(o>=3)return console.log(`âš ï¸ è¾¾åˆ°æœ€å¤§å±‚çº§é™åˆ¶ (level ${o}), è·³è¿‡æ¸²æŸ“`),"";console.log(`ğŸ” [Level ${o}] æ¸²æŸ“å›å¤: ${e.username}`),console.log(`   - reply_id: ${e.reply_id}`),console.log(`   - parent_reply_id: ${e.parent_reply_id||"none"}`),console.log(`   - reply_to_username: ${e.reply_to_username||"none"}`),console.log(`   - childrenæ•°é‡: ${e.children?e.children.length:0}`);let n=escapeHtml(e.content);e.reply_to_username&&(n=`<span class="reply-mention">@${escapeHtml(e.reply_to_username)}</span> ${n}`);let s="";if(e.children&&e.children.length>0){console.log(`ğŸŒ³ [Level ${o}] å¼€å§‹æ¸²æŸ“ ${e.children.length} ä¸ªå­å›å¤:`),e.children.forEach((e,t)=>{console.log(`   å­å›å¤ ${t}: ${e.username} (levelå°†ä¸º ${o+1})`)});const n=e.children.map(e=>{const n=renderReply(e,t,o+1);return console.log(`   å­å›å¤HTMLç”Ÿæˆ: ${n.length>0?"æˆåŠŸ":"å¤±è´¥"} (é•¿åº¦: ${n.length})`),n}).filter(e=>e.length>0);n.length>0?(s=`<div class="sub-replies" style="margin-top: 12px; padding-left: 16px; border-left: 2px solid #e9ecef; background-color: rgba(139, 92, 246, 0.05); display: block !important; visibility: visible !important;">${n.join("")}</div>`,console.log(`ğŸ¨ [Level ${o}] å­å›å¤å®¹å™¨HTMLé•¿åº¦: ${s.length}`)):console.log(`ğŸ“„ [Level ${o}] å­å›å¤æ¸²æŸ“åä¸ºç©º`)}else console.log(`ğŸ“„ [Level ${o}] æ— å­å›å¤`);const l=o<2,r=`reply-${t}-${e.reply_id}`,c=`showReplyToReplyForm('${t}', '${e.reply_id}', '${escapeHtml(e.username).replace(/'/g,"\\'")}', ${o})`,a=`\n        <div class="reply-item level-${o}" id="${r}" data-reply-id="${e.reply_id}" data-comment-id="${t}" data-level="${o}" style="\n            background: ${0===o?"linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%)":1===o?"linear-gradient(135deg, #f8faff 0%, #f1f5ff 100%)":"linear-gradient(135deg, #fafbff 0%, #f6f8ff 100%)"}; \n            border: 1px solid #e9ecef; \n            border-left: 4px solid ${0===o?"#8b5cf6":1===o?"#7c3aed":"#6d28d9"}; \n            border-radius: 8px; \n            padding: 12px; \n            margin-bottom: 12px; \n            margin-left: ${20*o}px;\n            min-height: 60px;\n            display: block !important;\n            visibility: visible !important;\n            opacity: 1 !important;\n        ">\n            <div class="flex items-start space-x-2" style="display: flex; align-items: flex-start; gap: 8px;">\n                <div class="user-avatar" style="\n                    width: 32px; \n                    height: 32px; \n                    background: linear-gradient(135deg, #8b5cf6, #7c3aed); \n                    color: white; \n                    border-radius: 50%; \n                    display: flex; \n                    align-items: center; \n                    justify-content: center; \n                    font-size: 14px; \n                    font-weight: bold;\n                    flex-shrink: 0;\n                ">\n                    ${e.username.charAt(0).toUpperCase()}\n                </div>\n                <div class="flex-1" style="flex: 1; min-width: 0;">\n                    <div class="flex items-center space-x-2 mb-1" style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">\n                        <span class="font-medium text-sm" style="font-weight: 600; font-size: 14px; color: #1f2937;">${escapeHtml(e.username)}</span>\n                        <span class="text-xs text-gray-500" style="font-size: 12px; color: #6b7280;">${formatTime(e.created_at)}</span>\n                        <span style="font-size: 10px; color: #8b5cf6; font-weight: bold;">[Level ${o}]</span>\n                    </div>\n                    <p class="comment-content text-gray-700 text-sm mb-2" style="color: #374151; font-size: 14px; margin-bottom: 8px; line-height: 1.5;">${n}</p>\n                    <div class="reply-actions flex items-center space-x-2" style="display: flex; align-items: center; gap: 8px;">\n                        <button onclick="likeReply('${t}', '${e.reply_id}')" class="btn-secondary text-xs" style="padding: 4px 8px; background: #6c757d; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">\n                            ğŸ‘ ${e.likes}\n                        </button>\n                        ${l?`\n                        <button onclick="${c}" class="btn-secondary text-xs reply-btn" data-reply-id="${e.reply_id}" data-comment-id="${t}" data-username="${escapeHtml(e.username)}" data-level="${o}" style="padding: 4px 8px; background: #6c757d; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">\n                            Reply\n                        </button>\n                        `:""}\n                    </div>\n                    ${s}\n                </div>\n            </div>\n        </div>\n    `;return console.log(`âœ… [Level ${o}] å›å¤HTMLç”Ÿæˆå®Œæˆï¼Œé•¿åº¦: ${a.length}`),a}function showReplyForm(e,t=0){console.log(`ğŸ” æ˜¾ç¤ºè¯„è®ºå›å¤è¡¨å• commentId=${e}, level=${t}`),hideAllReplyForms();const o=document.getElementById("reply-form-template");if(!o)return console.error("æ‰¾ä¸åˆ°å›å¤è¡¨å•æ¨¡æ¿ï¼Œç­‰å¾…DOMå®Œå…¨åŠ è½½åé‡è¯•..."),void setTimeout(()=>{if(!document.getElementById("reply-form-template"))return console.error("é‡è¯•åä»æ‰¾ä¸åˆ°å›å¤è¡¨å•æ¨¡æ¿"),void showSuccessToast("Comment system loading, please try again later");showReplyForm(e,t)},500);const n=o.content.cloneNode(!0).firstElementChild,s=allComments.find(t=>t.comment_id===e);if(!s)return void console.error(`æ‰¾ä¸åˆ°è¯„è®ºå¯¹è±¡ ID=${e}`);const l=n.querySelector(".reply-to-username");l&&(l.textContent=s.username||""),n.id=`reply-form-${e}`,console.log(`åˆ›å»ºå›å¤è¡¨å• ID=${n.id}`);const r=document.querySelector(`.comment-item button[onclick*="showReplyForm('${e}'"]`);if(r){const t=r.closest(".comment-item");if(!t)return void console.error(`æ‰¾ä¸åˆ°è¯„è®ºé¡¹ç›® commentId=${e}`);const o=t.querySelector(".comment-actions");if(!o)return void console.error(`æ‰¾ä¸åˆ°è¯„è®ºæ“ä½œåŒºåŸŸ commentId=${e}`);o.insertAdjacentElement("afterend",n),console.log("æˆåŠŸæ·»åŠ å›å¤è¡¨å•")}else{console.error(`æ‰¾ä¸åˆ°è¯„è®ºå…ƒç´ æŒ‰é’® commentId=${e}`);const t=document.querySelector(`.comment-item[data-comment-id="${e}"]`);if(!t)return void console.error(`ä»æ‰¾ä¸åˆ°è¯„è®ºå…ƒç´  commentId=${e}`);const o=t.querySelector(".comment-actions");if(!o)return void console.error(`æ‰¾ä¸åˆ°è¯„è®ºæ“ä½œåŒºåŸŸ commentId=${e}`);o.insertAdjacentElement("afterend",n),console.log("æˆåŠŸæ·»åŠ å›å¤è¡¨å•ï¼ˆæ›¿ä»£æ–¹æ³•ï¼‰")}const c=n.querySelector(".submit-reply-btn");c&&c.addEventListener("click",function(){console.log(`ç‚¹å‡»æäº¤è¯„è®ºå›å¤æŒ‰é’® commentId=${e}`),submitReply(e)});const a=n.querySelector(".cancel-reply-btn");a&&a.addEventListener("click",function(){console.log("ç‚¹å‡»å–æ¶ˆå›å¤æŒ‰é’®"),hideAllReplyForms()}),setTimeout(()=>{initReplyFormEmoji(n);const e=n.querySelector(".reply-content");e&&e.focus(),debugEmojiTrigger()},100)}function showReplyToReplyForm(e,t,o,n=0){if(console.log(`ğŸ” æ˜¾ç¤ºå›å¤çš„å›å¤è¡¨å•: commentId=${e}, parentReplyId=${t}, parentUsername=${o}, level=${n}`),n>=2)return void showSuccessToast("Maximum reply depth reached. Please reply in the main comment area.");hideAllReplyForms();const s=document.getElementById("reply-form-template");if(!s)return console.error("Reply form template not found, retrying after DOM loads..."),void setTimeout(()=>{if(!document.getElementById("reply-form-template"))return console.error("Reply form template still not found after retry"),void showSuccessToast("Reply form not found, please reload page");showReplyToReplyForm(e,t,o,n)},500);const l=s.content.cloneNode(!0).firstElementChild,r=l.querySelector(".reply-to-username");r&&(r.textContent=o||""),l.id=`reply-form-${e}-${t}`,console.log(`åˆ›å»ºå›å¤çš„å›å¤è¡¨å• ID=${l.id}`),console.log(`æŸ¥æ‰¾å›å¤å…ƒç´  parentReplyId=${t}`);let c=document.getElementById(`reply-${e}-${t}`);if(c||(c=document.querySelector(`.reply-item[data-reply-id="${t}"][data-comment-id="${e}"]`)),!c){const o=document.querySelectorAll(".reply-item .reply-actions button.reply-btn, .reply-item .reply-actions button.btn-secondary");for(const n of o)if(console.log("æ£€æŸ¥æŒ‰é’®:",n.outerHTML),n.dataset.replyId===t||n.dataset.commentId===e||n.getAttribute("onclick")?.includes(t)){c=n.closest(".reply-item"),console.log("é€šè¿‡æŒ‰é’®æ‰¾åˆ°å›å¤å…ƒç´ ");break}}if(c){console.log("æ‰¾åˆ°å›å¤å…ƒç´ :",c);const n=c.querySelector(".reply-actions");if(n){console.log("æ‰¾åˆ°å›å¤æ“ä½œåŒºåŸŸ"),n.insertAdjacentElement("afterend",l),console.log("æˆåŠŸæ·»åŠ å›å¤è¡¨å•åˆ°å›å¤å…ƒç´ ");const s=l.querySelector(".submit-reply-btn");s&&s.addEventListener("click",function(){console.log(`ç‚¹å‡»æäº¤å›å¤çš„å›å¤æŒ‰é’® commentId=${e}, parentReplyId=${t}, parentUsername=${o}`),submitReplyToReply(e,t,o)});const r=l.querySelector(".cancel-reply-btn");r&&r.addEventListener("click",function(){console.log("ç‚¹å‡»å–æ¶ˆå›å¤æŒ‰é’®"),hideAllReplyForms()}),setTimeout(()=>{initReplyFormEmoji(l);const e=l.querySelector(".reply-content");e&&(e.value=`@${o} `,e.focus(),e.selectionStart=e.selectionEnd=e.value.length),debugEmojiTrigger()},100)}else console.error("æ— æ³•æ‰¾åˆ°å›å¤æ“ä½œåŒºåŸŸ")}else{console.error(`æ— æ³•æ‰¾åˆ°å›å¤å…ƒç´ ï¼ŒcommentId=${e}, parentReplyId=${t}`);const o=document.querySelectorAll(".reply-item");console.log(`é¡µé¢ä¸Šæ€»å…±æœ‰ ${o.length} ä¸ªå›å¤å…ƒç´ `),o.forEach((e,t)=>{console.log(`å›å¤å…ƒç´  ${t+1}:`,{id:e.id,dataReplyId:e.dataset.replyId,dataCommentId:e.dataset.commentId,html:e.outerHTML.substring(0,100)+"..."})})}}async function submitReply(e){console.log(`ğŸš€ æäº¤ç›´æ¥å›å¤: commentId=${e}`);let t=document.getElementById(`reply-form-${e}`);if(!t){const o=document.querySelectorAll(`[id^="reply-form-${e}"]`);o.length>0&&(t=o[0],console.log(`Found reply form with extended ID: ${t.id}`))}if(t||(t=document.querySelector(`[data-comment-id="${e}"] .reply-form`)),!t){const o=document.querySelectorAll(".reply-form");for(let n of o)if(n.closest(`[data-comment-id="${e}"]`)){t=n;break}}if(!t)return console.error("âŒ Reply form not found, debugging..."),console.log(`Looking for reply-form-${e}`),console.log("Available comment elements:",document.querySelectorAll("[data-comment-id]")),console.log("Available reply forms:",document.querySelectorAll(".reply-form")),void setTimeout(()=>{let t=document.getElementById(`reply-form-${e}`);if(!t){const o=document.querySelectorAll(`[id^="reply-form-${e}"]`);o.length>0&&(t=o[0])}t||(t=document.querySelector(`[data-comment-id="${e}"] .reply-form`)),t?(console.log("Retry successful, resubmitting..."),submitReply(e)):showSuccessToast("Reply form not found, please click reply button again")},500);const o=t.querySelector(".reply-username"),n=t.querySelector(".reply-content");if(!o||!n)return console.error("âŒ Reply form elements not found"),void showSuccessToast("Form elements loading error, please refresh page");const s=o.value.trim()||"Anonymous",l=n.value.trim();if(!l)return showSuccessToast("Please enter a reply"),void n.focus();if(l.length<5)return showSuccessToast("Reply must be at least 5 characters long"),void n.focus();if(l.length>2e3)return showSuccessToast("Reply must be less than 2000 characters"),void n.focus();if(s.length>50)return showSuccessToast("Username must be less than 50 characters"),void o.focus();const r=t.querySelector(".submit-reply-btn"),c=r?r.textContent:"";r&&(r.textContent="Submitting...",r.disabled=!0);try{console.log("ğŸ“¡ å‘é€ç›´æ¥å›å¤è¯·æ±‚..."),console.log(`ğŸ” Debug info: commentId=${e}`),console.log(`ğŸ” API URL: /api/comments/${e}/reply`);const t=await fetch(`/api/comments/${e}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,content:l})}),o=await t.json();console.log("ğŸ“¡ ç›´æ¥å›å¤å“åº”:",o),o.success?(console.log("ğŸ‰ ç›´æ¥å›å¤æäº¤æˆåŠŸ!"),showSuccessToast("Reply submitted successfully!"),hideAllReplyForms(),await loadComments()):(console.error("âŒ ç›´æ¥å›å¤æäº¤å¤±è´¥:",o.message),showSuccessToast("Reply submission failed: "+o.message))}catch(e){console.error("ğŸ”¥ ç›´æ¥å›å¤æäº¤å‡ºé”™:",e),showSuccessToast("Network error, please try again later")}finally{r&&(r.textContent=c,r.disabled=!1)}}async function submitReplyToReply(e,t,o){console.log(`ğŸš€ æäº¤å±‚çº§å›å¤: commentId=${e}, parentReplyId=${t}, parentUsername=${o}`);let n=document.getElementById(`reply-form-${e}-${t}`);if(!n){const o=document.querySelectorAll(`[id^="reply-form-${e}"]`);for(let e of o)if(e.id.includes(t)){n=e,console.log(`Found reply form with ID: ${e.id}`);break}}if(n||(n=document.querySelector(`[data-comment-id="${e}"] .reply-form`)),!n){const t=document.querySelectorAll(".reply-form");for(let o of t){if(o.closest(`[data-comment-id="${e}"]`)){n=o;break}}}if(!n)return console.error("âŒ Reply form not found, debugging..."),console.log(`Looking for reply-form-${e}-${t}`),console.log("Available comment elements:",document.querySelectorAll("[data-comment-id]")),console.log("Available reply forms:",document.querySelectorAll(".reply-form")),void setTimeout(()=>{let n=document.getElementById(`reply-form-${e}-${t}`);if(!n){const o=document.querySelectorAll(`[id^="reply-form-${e}"]`);for(let e of o)if(e.id.includes(t)){n=e;break}}n||(n=document.querySelector(`[data-comment-id="${e}"] .reply-form`)),n?(console.log("Retry successful for reply to reply, resubmitting..."),submitReplyToReply(e,t,o)):showSuccessToast("Reply form not found, please click reply button again")},500);const s=n.querySelector(".reply-username"),l=n.querySelector(".reply-content");if(!s||!l)return console.error("âŒ Reply form elements not found"),void showSuccessToast("Form elements loading error, please refresh page");const r=s.value.trim()||"Anonymous",c=l.value.trim();if(!c)return showSuccessToast("Please enter a reply"),void l.focus();if(c.length<5)return showSuccessToast("Reply must be at least 5 characters long"),void l.focus();if(c.length>2e3)return showSuccessToast("Reply must be less than 2000 characters"),void l.focus();if(r.length>50)return showSuccessToast("Username must be less than 50 characters"),void s.focus();const a=n.querySelector(".submit-reply-btn"),i=a?a.textContent:"";a&&(a.textContent="Submitting...",a.disabled=!0);try{console.log("ğŸ“¡ å‘é€å±‚çº§å›å¤è¯·æ±‚..."),console.log(`ğŸ” Debug info: commentId=${e}, parentReplyId=${t}, parentUsername=${o}`),console.log(`ğŸ” API URL: /api/comments/${e}/reply`);const n=await fetch(`/api/comments/${e}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,content:c,parent_reply_id:t,reply_to_username:o})}),s=await n.json();console.log("ğŸ“¡ å±‚çº§å›å¤å“åº”:",s),s.success?(console.log("ğŸ‰ å±‚çº§å›å¤æäº¤æˆåŠŸ!"),showSuccessToast("Reply submitted successfully!"),hideAllReplyForms(),await loadComments()):(console.error("âŒ å±‚çº§å›å¤æäº¤å¤±è´¥:",s.message),showSuccessToast("Reply submission failed: "+s.message))}catch(e){console.error("ğŸ”¥ å±‚çº§å›å¤æäº¤å‡ºé”™:",e),showSuccessToast("Network error, please try again later")}finally{a&&(a.textContent=i,a.disabled=!1)}}function hideReplyForm(e){const t=document.getElementById(`reply-form-${e}`);t&&t.remove()}function hideAllReplyForms(){console.log("ğŸ§¹ éšè—æ‰€æœ‰å›å¤è¡¨å•...");const e=document.querySelectorAll(".reply-form");let t=0;0!==e.length?(console.log(`æ‰¾åˆ° ${e.length} ä¸ªå›å¤è¡¨å•`),e.forEach((e,o)=>{try{console.log(`  ç§»é™¤è¡¨å• ${o+1}: ID=${e.id||"æ— ID"}`);e.querySelectorAll(".emoji-trigger").forEach(e=>{const t=e.cloneNode(!0);e.parentNode&&e.parentNode.replaceChild(t,e)});e.querySelectorAll("button").forEach(e=>{const t=e.cloneNode(!0);e.parentNode&&e.parentNode.replaceChild(t,e)}),e.parentNode.removeChild(e),t++}catch(e){console.error(`ç§»é™¤è¡¨å•å¤±è´¥ ${o+1}:`,e)}}),document.querySelectorAll(".emoji-panel").forEach(e=>{e.style.display="none"}),console.log(`âœ… æˆåŠŸéšè— ${t} ä¸ªå›å¤è¡¨å•`)):console.log("æ²¡æœ‰æ‰¾åˆ°å›å¤è¡¨å•")}function updateLoadMoreButton(){const e=document.getElementById("load-more-section"),t=document.getElementById("load-more-btn");if(!e||!t)return void console.log("âš ï¸ åŠ è½½æ›´å¤šæŒ‰é’®å…ƒç´ ä¸å­˜åœ¨");const o=displayedComments.length<allComments.length;if(console.log(`ğŸ” æ›´æ–°åŠ è½½æ›´å¤šæŒ‰é’®: æ˜¾ç¤º${displayedComments.length}æ¡, æ€»è®¡${allComments.length}æ¡, æœ‰æ›´å¤š: ${o}`),o){e.classList.remove("hidden");const o=allComments.length-displayedComments.length;t.textContent=`Load More Comments (${o})`,console.log(`âœ… æ˜¾ç¤ºåŠ è½½æ›´å¤šæŒ‰é’®ï¼Œå‰©ä½™${o}æ¡è¯„è®º`)}else e.classList.add("hidden"),console.log("âŒ éšè—åŠ è½½æ›´å¤šæŒ‰é’®ï¼Œæ²¡æœ‰æ›´å¤šè¯„è®º")}function updateCommentStats(){const e=allComments.length,t=allComments.length>0?(allComments.reduce((e,t)=>e+t.rating,0)/allComments.length).toFixed(1):0,o=document.getElementById("total-comments"),n=document.getElementById("average-rating");o&&(o.textContent=`${e} comments`),n&&(n.textContent=`${t} â˜…`)}async function submitComment(){console.log("ğŸš€ å¼€å§‹æäº¤è¯„è®º...");const e=getActiveInputs();if(!e.commentInput||!e.usernameInput||!e.emailInput)return console.error("âŒ æ‰¾ä¸åˆ°å¿…éœ€çš„è¾“å…¥å…ƒç´ "),void showSuccessToast("Page elements loading error, please refresh the page and try again");const t=e.commentInput.value.trim(),o=e.usernameInput.value.trim()||"Anonymous",n=e.emailInput.value.trim();if(console.log("ğŸ“ è¯„è®ºæäº¤å‰æ£€æŸ¥:"),console.log("   å†…å®¹:",t),console.log("   Username:",o),console.log("   é‚®ç®±:",n),console.log("   å½“å‰è¯„åˆ†:",currentRating),console.log("   å†…å®¹é•¿åº¦:",t.length),console.log("   Username length:",o.length),!t)return console.warn("âš ï¸ Validation failed: Content is empty"),showSuccessToast("Please enter a comment"),void e.commentInput.focus();if(t.length<10)return console.warn("âš ï¸ Validation failed: Content too short"),showSuccessToast("Comment must be at least 10 characters long"),void e.commentInput.focus();if(t.length>1e3)return console.warn("âš ï¸ Validation failed: Content too long"),showSuccessToast("Comment must be less than 1000 characters"),void e.commentInput.focus();if(console.log("ğŸ” è¯„åˆ†éªŒè¯: currentRating =",currentRating,"(ç±»å‹:",typeof currentRating,")"),0===currentRating||null==currentRating){console.warn("âš ï¸ Validation failed: No rating selected"),showSuccessToast("Please select a rating");const e=document.querySelector(".rating-input-container");return void(e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.style.border="2px solid #ff6b6b",setTimeout(()=>{e.style.border=""},3e3)))}if(currentRating<1||currentRating>5)return console.warn("âš ï¸ Validation failed: Rating out of range"),void showSuccessToast("Rating must be between 1 and 5");if(o.length>50)return console.warn("âš ï¸ Validation failed: Username too long"),showSuccessToast("Username must be less than 50 characters"),void e.usernameInput.focus();if(!/^[a-zA-Z0-9_\u4e00-\u9fa5\u3040-\u309f\u30a0-\u30ff\s]+$/.test(o))return console.warn("âš ï¸ Validation failed: Username contains invalid characters"),showSuccessToast("Username can only contain letters, numbers, underscores, Chinese characters, Japanese characters and spaces"),void e.usernameInput.focus();if(!n)return console.warn("âš ï¸ Validation failed: Email is required"),showSuccessToast("Please enter an email address"),void e.emailInput.focus();if(!validateEmail(n))return console.warn("âš ï¸ Validation failed: Invalid email format"),showSuccessToast("Please enter a valid email address"),void e.emailInput.focus();console.log("âœ… å‰ç«¯éªŒè¯é€šè¿‡ï¼Œå‡†å¤‡æäº¤..."),e.submitText&&e.submitLoading&&(e.submitText.textContent="Posting...",e.submitLoading.classList.remove("hidden"));try{const s={username:String(o),email:String(n),content:String(t),rating:parseInt(currentRating)};if(console.log("ğŸ“¦ å‡†å¤‡æäº¤çš„æ•°æ®:"),console.log("   æ•°æ®å¯¹è±¡:",s),console.log("   JSONå­—ç¬¦ä¸²:",JSON.stringify(s)),console.log("ğŸ” æ•°æ®ç±»å‹æ£€æŸ¥:"),Object.entries(s).forEach(([e,t])=>{console.log(`   ${e}: ${typeof t} = ${JSON.stringify(t)}`)}),!s.username||!s.content||!s.rating)throw new Error("Data validation failed: missing required fields");if(isNaN(s.rating)||s.rating<1||s.rating>5)throw new Error("Data validation failed: invalid rating");const l=getArticleUrl();console.log("Submitting comment for article_url:",l);const r=`/api/comments${l}`;console.log("Submit API URL:",r);const c=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("ğŸ“¡ APIå“åº”çŠ¶æ€:",c.status),console.log("ğŸ“¡ APIå“åº”å¤´:",c.headers),!c.ok)throw new Error(`HTTPé”™è¯¯: ${c.status} ${c.statusText}`);const a=await c.json();if(console.log("ğŸ“¡ APIå“åº”æ•°æ®:",a),a.success){console.log("ğŸ‰ è¯„è®ºæäº¤æˆåŠŸ!"),e.commentInput.value="",e.usernameInput.value="",e.emailInput.value="",currentRating=0,highlightStars(0),showSuccessToast("Success!"),await loadComments();const t=document.getElementById("comments-list");t&&t.scrollIntoView({behavior:"smooth"})}else{console.error("âŒ Submission failed details:",a);let e="Submission failed: "+a.message;a.errors&&Array.isArray(a.errors)&&(e+=". Details: "+a.errors.join(", ")),showSuccessToast(e)}}catch(e){console.error("ğŸ”¥ æäº¤è¯„è®ºå‡ºé”™:",e),showSuccessToast("Network error, please try again later")}finally{e.submitText&&e.submitLoading&&(e.submitText.textContent="Post Comment",e.submitLoading.classList.add("hidden"))}}function validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}async function likeComment(e){try{const t=await fetch(`/api/comments/${e}/like`,{method:"POST"}),o=await t.json();o.success?(showSuccessToast("ğŸ‘ Liked successfully!"),await loadComments()):showSuccessToast("ç‚¹èµå¤±è´¥: "+o.message)}catch(e){console.error("ç‚¹èµå‡ºé”™:",e),showSuccessToast("Network error, please try again later")}}async function likeReply(e,t){try{const o=await fetch(`/api/comments/${e}/reply/${t}/like`,{method:"POST"}),n=await o.json();n.success?(showSuccessToast("ğŸ‘ Reply liked successfully!"),await loadComments()):showSuccessToast("ç‚¹èµå¤±è´¥: "+n.message)}catch(e){console.error("ç‚¹èµå‡ºé”™:",e),showSuccessToast("Network error, please try again later")}}async function loadMoreComments(){const e=document.getElementById("load-more-btn");e.textContent;e.innerHTML='<div class="loading-spinner mx-auto"></div>',e.disabled=!0;try{const e=displayedComments.length,t=allComments.slice(e,e+commentsPerPage);displayedComments.push(...t),renderComments(),updateLoadMoreButton()}catch(e){console.error("åŠ è½½æ›´å¤šè¯„è®ºå‡ºé”™:",e)}finally{e.disabled=!1,updateLoadMoreButton()}}function escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return e.replace(/[&<>"]/g,function(e){return t[e]})}function formatTime(e){const t=new Date(e),o=new Date-t;return o<6e4?"just now":o<36e5?Math.floor(o/6e4)+" minutes ago":o<864e5?Math.floor(o/36e5)+" hours ago":o<6048e5?Math.floor(o/864e5)+" days ago":t.toLocaleDateString()}function showSuccessToast(e){const t=document.querySelector(".success-toast");t&&t.remove();const o=document.createElement("div");o.className="success-toast",o.innerHTML=`\n        <span class="icon">âœ…</span>\n        ${e}\n        <button class="close-btn" onclick="this.parentElement.remove()">Ã—</button>\n    `,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},100),setTimeout(()=>{o.parentElement&&(o.classList.remove("show"),setTimeout(()=>{o.parentElement&&o.remove()},300))},4e3)}function debugEmojiTrigger(){console.log("ğŸ”§ å¼€å§‹è°ƒè¯•è¡¨æƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶...");const e=document.querySelectorAll(".emoji-trigger");console.log(`æ‰¾åˆ° ${e.length} ä¸ªè¡¨æƒ…æŒ‰é’®`),e.forEach((e,t)=>{console.log(`ç»‘å®šç¬¬ ${t+1} ä¸ªè¡¨æƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶`);const o=e.cloneNode(!0);e.parentNode.replaceChild(o,e),o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log(`è¡¨æƒ…æŒ‰é’® ${t+1} è¢«ç‚¹å‡»!`);const o=this.closest(".emoji-picker-container").querySelector(".emoji-panel");if(o)o.classList.contains("show")?(console.log("å…³é—­è¡¨æƒ…é¢æ¿"),o.classList.remove("show")):(console.log("æ‰“å¼€è¡¨æƒ…é¢æ¿"),o.classList.add("show"),document.querySelectorAll(".emoji-panel.show").forEach(e=>{e!==o&&e.classList.remove("show")}));else{console.error("æ‰¾ä¸åˆ°è¡¨æƒ…é¢æ¿!");const e=this.closest(".emoji-picker-container"),t=document.createElement("div");t.className="emoji-panel",t.innerHTML='\n                    <div style="padding: 10px; background: white; border: 1px solid #ddd;">\n                        <div>ğŸ˜Š ğŸ˜‚ â¤ï¸ ğŸ‘ ğŸ‰</div>\n                        <div>âœ¨ ğŸŒŸ ğŸ’¯ ğŸ”¥ ğŸ‘</div>\n                    </div>\n                ',e.appendChild(t),t.classList.add("show"),t.addEventListener("click",e=>{if(e.target.textContent.trim()){const o=e.target.textContent.trim(),n=e.target.closest(".emoji-picker-container").parentNode.querySelector("textarea");if(n){const e=n.selectionStart;n.value=n.value.substring(0,e)+o+n.value.substring(n.selectionEnd),n.focus(),n.selectionStart=n.selectionEnd=e+o.length,t.classList.remove("show")}}})}})})}function toggleEmojiPanel(e,t){console.log("åˆ‡æ¢è¡¨æƒ…é¢æ¿",e,t);const o=document.getElementById(e);function n(t){const o=document.getElementById(e),s=document.querySelector(`[onclick*="toggleEmojiPanel('${e}"]`);!o||o.contains(t.target)||s&&s.contains(t.target)||(o.style.display="none",document.removeEventListener("click",n))}o&&("none"!==o.style.display&&o.style.display?(o.style.display="none",document.removeEventListener("click",n)):(o.style.display="block",document.querySelectorAll(".emoji-panel").forEach(t=>{t.id!==e&&"none"!==t.style.display&&(t.style.display="none")}),setTimeout(()=>{document.addEventListener("click",n)},100)))}function switchEmojiCategory(e,t){console.log("åˆ‡æ¢è¡¨æƒ…åˆ†ç±»",e,t),document.querySelectorAll(`#${e} .emoji-grid`).forEach(e=>{e.style.display="none"});const o=document.getElementById(`${e}-${t}`);o&&(o.style.display="grid"),document.querySelectorAll(`#${e} .emoji-tab`).forEach(e=>{e.classList.remove("active")});const n=document.querySelector(`#${e} .emoji-tab[onclick*="'${t}'"]`);n&&n.classList.add("active")}function insertEmoji(e,t){console.log("æ’å…¥è¡¨æƒ…",e,t);const o=document.getElementById(e);if(o){const e=o.selectionStart,n=o.selectionEnd,s=o.value;o.value=s.substring(0,e)+t+s.substring(n),o.focus(),o.selectionStart=o.selectionEnd=e+t.length,document.querySelectorAll(".emoji-panel").forEach(e=>{e.style.display="none"})}}console.log("ğŸš€ è¯„è®ºç³»ç»Ÿåˆå§‹åŒ–"),console.log("å½“å‰URL:",window.location.href),console.log("å½“å‰è·¯å¾„:",window.location.pathname),console.log("åˆå§‹è¯„åˆ†:",currentRating),document.addEventListener("DOMContentLoaded",function(){console.log("ğŸ“… DOMåŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–è¯„è®ºç³»ç»Ÿ..."),initializeCommentSystem()}),window.testReplyHierarchy=function(){console.log("ğŸ§ª å¼€å§‹æµ‹è¯•å±‚çº§å›å¤åŠŸèƒ½...");const e=[{comment_id:"test-comment-1",username:"æµ‹è¯•ç”¨æˆ·1",content:"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¯„è®º",rating:5,likes:2,created_at:"2024-01-01 10:00:00",replies:[{reply_id:"test-reply-1",username:"å›å¤ç”¨æˆ·1",content:"è¿™æ˜¯ç¬¬ä¸€å±‚å›å¤",likes:1,created_at:"2024-01-01 10:05:00",parent_reply_id:null,reply_to_username:null,children:[{reply_id:"test-reply-2",username:"å›å¤ç”¨æˆ·2",content:"è¿™æ˜¯ç¬¬äºŒå±‚å›å¤",likes:0,created_at:"2024-01-01 10:10:00",parent_reply_id:"test-reply-1",reply_to_username:"å›å¤ç”¨æˆ·1",children:[{reply_id:"test-reply-3",username:"å›å¤ç”¨æˆ·3",content:"è¿™æ˜¯ç¬¬ä¸‰å±‚å›å¤",likes:0,created_at:"2024-01-01 10:15:00",parent_reply_id:"test-reply-2",reply_to_username:"å›å¤ç”¨æˆ·2",children:[]}]}]}]}];allComments=e,displayedComments=e,console.log("ğŸ“Š æµ‹è¯•æ•°æ®è®¾ç½®å®Œæˆ:"),console.log("  - è¯„è®ºæ•°é‡:",allComments.length),console.log("  - å›å¤å±‚çº§ç»“æ„:",JSON.stringify(e[0].replies,null,2));try{renderComments(),console.log("âœ… å±‚çº§å›å¤æ¸²æŸ“æµ‹è¯•é€šè¿‡"),setTimeout(()=>{console.log("ğŸ”§ æµ‹è¯•å›å¤è¡¨å•åŠŸèƒ½..."),showReplyForm("test-comment-1",0),console.log("âœ… ç¬¬ä¸€å±‚å›å¤è¡¨å•æ˜¾ç¤ºæµ‹è¯•é€šè¿‡"),setTimeout(()=>{showReplyToReplyForm("test-comment-1","test-reply-1","å›å¤ç”¨æˆ·1",0),console.log("âœ… ç¬¬äºŒå±‚å›å¤è¡¨å•æ˜¾ç¤ºæµ‹è¯•é€šè¿‡"),setTimeout(()=>{console.log("ğŸš§ æµ‹è¯•å±‚çº§é™åˆ¶åŠŸèƒ½ (level=2, åº”è¯¥æ˜¾ç¤ºè­¦å‘Š)..."),showReplyToReplyForm("test-comment-1","test-reply-2","å›å¤ç”¨æˆ·2",2),console.log("âœ… å±‚çº§é™åˆ¶æµ‹è¯•é€šè¿‡ (åº”è¯¥æ˜¾ç¤ºè­¦å‘Š)"),setTimeout(()=>{console.log("ğŸ‰ æ‰€æœ‰å±‚çº§å›å¤åŠŸèƒ½æµ‹è¯•å®Œæˆ!"),console.log("ğŸ“‹ æµ‹è¯•ç»“æœæ€»ç»“:"),console.log("   âœ… å±‚çº§å›å¤æ¸²æŸ“ - é€šè¿‡"),console.log("   âœ… è¡¨å•æ˜¾ç¤ºåŠŸèƒ½ - é€šè¿‡"),console.log("   âœ… å±‚çº§é™åˆ¶æ£€æŸ¥ - é€šè¿‡"),console.log("   ğŸ“Š æ”¯æŒçš„å±‚çº§: æ˜¾ç¤º3å±‚, å¯å›å¤2å±‚")},200)},500)},500)},1e3)}catch(e){console.error("âŒ å±‚çº§å›å¤æµ‹è¯•å¤±è´¥:",e)}},console.log("ğŸ’¡ å±‚çº§å›å¤åŠŸèƒ½å·²åŒæ­¥!"),console.log("   å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ testReplyHierarchy() æ¥æµ‹è¯•åŠŸèƒ½"),console.log("   åŠŸèƒ½åŒ…æ‹¬:"),console.log("   1. âœ… å®Œæ•´çš„è¯„è®ºå’Œå›å¤ç³»ç»Ÿ"),console.log("   2. âœ… ç»Ÿä¸€å±‚çº§é™åˆ¶ (æœ€å¤š3å±‚æ˜¾ç¤º, 2å±‚å¯å›å¤)"),console.log("   3. âœ… è¡¨å•ç®¡ç†å’Œé”™è¯¯å¤„ç†"),console.log("   4. âœ… è¡¨æƒ…é€‰æ‹©å™¨é›†æˆ"),console.log("   5. âœ… å®Œå–„çš„CSSæ ·å¼æ”¯æŒ"),document.addEventListener("DOMContentLoaded",function(){setTimeout(debugEmojiTrigger,1e3),document.addEventListener("click",function(e){if(e.target.classList.contains("submit-reply-btn")){e.preventDefault();const t=e.target.closest(".reply-form");if(t){const e=t.id;if(e){const o=e.replace("reply-form-","").split("-"),n=o[0],s=o.length>1?o[1]:null,l=t.querySelector(".reply-to-username"),r=l?l.textContent:"";console.log(`æäº¤å›å¤è¡¨å•: commentId=${n}, parentReplyId=${s}, parentUsername=${r}`),s&&"0"!==s?submitReplyToReply(n,s,r):submitReply(n)}}}e.target.classList.contains("cancel-reply-btn")&&(e.preventDefault(),hideAllReplyForms())})}),document.addEventListener("DOMContentLoaded",function(){console.log("ğŸš€ DOMåŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–è¡¨æƒ…é€‰æ‹©å™¨..."),setTimeout(function(){console.log("ğŸ”§ å¼€å§‹è°ƒè¯•è¡¨æƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶...");const e=document.querySelectorAll('[id$="-emoji-btn"]');console.log(`æ‰¾åˆ° ${e.length} ä¸ªè¡¨æƒ…æŒ‰é’®`),e.forEach((e,t)=>{console.log(`ç»‘å®šç¬¬ ${t+1} ä¸ªè¡¨æƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶: ${e.id}`);const o=e.cloneNode(!0);e.parentNode.replaceChild(o,e),o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log(`è¡¨æƒ…æŒ‰é’® ${t+1} è¢«ç‚¹å‡»!`);toggleEmojiPanel(o.id.replace("-btn","-panel"),o.id.includes("desktop")?"comment-input-desktop":"comment-input-mobile")})}),console.log("âœ… è¡¨æƒ…æŒ‰é’®è°ƒè¯•äº‹ä»¶ç»‘å®šå®Œæˆ")},1e3),document.addEventListener("click",function(e){e.target.classList.contains("btn-secondary")&&(e.target.textContent.includes("Reply")||e.target.textContent.includes("å›å¤"))&&setTimeout(()=>{document.querySelectorAll(".reply-form").forEach((e,t)=>{if(!e.dataset.emojiInitialized){const o=e.querySelector("textarea"),n=e.querySelector(".emoji-picker-container");if(o&&n){const s=o.id||`reply-textarea-${t}`,l=`emoji-panel-${s}`;o.id||(o.id=s),n.innerHTML=`\n                                <button type="button" class="p-2 hover:bg-gray-100 rounded-full"\n                                        title="Insert emoji"\n                                        onclick="toggleEmojiPanel('${l}', '${s}')">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <circle cx="12" cy="12" r="10"></circle>\n                                        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>\n                                        <line x1="9" y1="9" x2="9.01" y2="9"></line>\n                                        <line x1="15" y1="9" x2="15.01" y2="9"></line>\n                                    </svg>\n                                </button>\n                                <div id="${l}" class="emoji-panel custom-emoji-panel">\n                                    <div class="emoji-grid">\n                                        <span class="emoji-item" onclick="insertEmoji('${s}', 'ğŸ˜Š')">ğŸ˜Š</span>\n                                        <span class="emoji-item" onclick="insertEmoji('${s}', 'ğŸ˜‚')">ğŸ˜‚</span>\n                                        <span class="emoji-item" onclick="insertEmoji('${s}', 'â¤ï¸')">â¤ï¸</span>\n                                        <span class="emoji-item" onclick="insertEmoji('${s}', 'ğŸ‘')">ğŸ‘</span>\n                                        <span class="emoji-item" onclick="insertEmoji('${s}', 'ğŸ‰')">ğŸ‰</span>\n                                        <span class="emoji-item" onclick="insertEmoji('${s}', 'âœ¨')">âœ¨</span>\n                                        <span class="emoji-item" onclick="insertEmoji('${s}', 'ğŸŒŸ')">ğŸŒŸ</span>\n                                        <span class="emoji-item" onclick="insertEmoji('${s}', 'ğŸ’¯')">ğŸ’¯</span>\n                                    </div>\n                                </div>\n                            `,e.dataset.emojiInitialized="true"}}})},300)})});